<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Mobile App — All-in-One Vertical</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg1:#04050a; --bg2:#071026; --muted:#9fb0c8 }
  html,body{ height:100%; margin:0 }
  body{ background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:#eaf2ff; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif; -webkit-font-smoothing:antialiased; padding:12px; display:flex; justify-content:center }
  .app{ width:100%; max-width:420px; display:flex; flex-direction:column; gap:12px }
  .section{ background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006)); border:1px solid rgba(255,255,255,0.04); border-radius:14px; box-shadow:0 16px 36px rgba(2,6,23,0.6); overflow:hidden }
  .header{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; font-weight:800; font-size:14px; color:#cfe8ff; border-bottom:1px solid rgba(255,255,255,0.04) }
  .frame{ width:100%; border:0; display:block }
  template{ display:none }
  .note{ display:none }
  
</style>
</head>
<body>
  <div class="app">
    <div class="section">
      <div class="header">Current Weather</div>
      <iframe class="frame" data-template="tpl-bubble" data-fallback="540"></iframe>
    </div>
    <div class="section">
      <div class="header">Hourly Forecast</div>
      <iframe class="frame" data-template="tpl-hourly" data-fallback="340"></iframe>
    </div>
    <div class="section">
      <div class="header">10-Day Forecast</div>
      <iframe class="frame" data-template="tpl-daily" data-fallback="800"></iframe>
    </div>
    <div class="section">
      <div class="header">Air Quality</div>
      <iframe class="frame" data-template="tpl-air" data-fallback="620"></iframe>
    </div>
    <div class="section">
      <div class="header">Metrics</div>
      <iframe class="frame" data-template="tpl-metrics" data-fallback="1220"></iframe>
    </div>
  </div>

<template id="tpl-bubble">
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Bubble Weather — Your App</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#05060a;
    --bg2:#0b1220;
    --bubble:#0f172a;
    --glass: rgba(255,255,255,0.04);
    --accent: #facc15;
    --accent-cool: #7dd3fc;
    --muted: #9fb0c8;
    --card-radius: 28px;
  }
  html,body{height:100%;width:100%;margin:0;padding:0;overflow:hidden; -webkit-font-smoothing:antialiased}
  body{
    display:flex;align-items:center;justify-content:center;
    background: radial-gradient(800px 600px at 10% 10%, rgba(124,58,237,0.06), transparent 8%),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
    color: #e8f0ff;
  }
  .wrap{ width:100%; max-width:420px; height:100vh; display:flex; align-items:center; justify-content:center; padding:18px; }
  .bubble-wrap{ width:min(92vw,380px); max-width:380px; aspect-ratio:1/1; position:relative; display:flex; align-items:center; justify-content:center; transform-origin:center; user-select:none; }
  .bubble{ width:100%; height:100%; border-radius:50%; background:
      radial-gradient(40% 36% at 28% 18%, rgba(255,255,255,0.06), transparent 12%),
      radial-gradient(30% 22% at 68% 20%, rgba(255,255,255,0.035), transparent 8%),
      linear-gradient(180deg, rgba(255,255,255,0.01), rgba(5,10,18,0.32)),
      linear-gradient(180deg, #071123, #071026);
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: inset 0 26px 40px rgba(255,255,255,0.02), inset 0 -10px 30px rgba(0,0,0,0.6), 0 18px 60px rgba(2,6,23,0.7);
    position:relative; overflow:visible; display:flex; align-items:center; justify-content:center; transition:transform .25s cubic-bezier(.2,.9,.2,1); backdrop-filter: blur(6px);
  }
  .bubble::before{ content:""; position:absolute;left:4%;right:4%;top:4%; height:26%; border-radius:50%; background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02)); filter: blur(8px); opacity:.9; transform:translateY(-6%); }
  .bubble::after{ content:""; position:absolute;left:10%;right:10%;bottom:6%; height:18%; background: radial-gradient(60% 50% at 50% 30%, rgba(255,255,255,0.03), transparent 45%); border-radius:50%; pointer-events:none; }
  .content{ width:78%; height:78%; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; gap:6px; position:relative; z-index:3; }
  .realfeel{ font-size:12px;font-weight:600;color:var(--muted); letter-spacing:.6px;margin-bottom:2px; }
  .temp{ font-size:64px; font-weight:800; line-height:1; letter-spacing:-1px; }
  .temp small{ font-size:28px; font-weight:700; vertical-align:super; margin-left:6px; color:rgba(255,255,255,0.9); }
  .condition{ font-size:18px;font-weight:700;color:#fff;margin-top:4px; }
  .minmax{ position:absolute; top:46%; left:12%; transform:translateY(-50%); text-align:center;font-weight:700; color:rgba(255,255,255,0.95);font-size:14px; }
  .minmax.right{ left:auto; right:12%; }
  .minmax .label{font-weight:600;color:var(--muted);font-size:11px}
  .minmax .val{display:block;margin-top:4px;font-size:16px}
  .stats{ margin-top:12px; background: rgba(0,0,0,0.28); border-radius:14px; padding:8px 12px; display:flex; gap:12px; align-items:center; box-shadow: 0 4px 18px rgba(2,6,23,0.45); border:1px solid rgba(255,255,255,0.03); backdrop-filter: blur(6px); }
  .stat{ display:flex;flex-direction:column;align-items:center;min-width:56px; }
  .stat .k{font-weight:700;font-size:13px}
  .stat .t{font-size:11px;color:var(--muted);margin-top:2px}
  .topbar{ position:absolute;left:8%;right:8%;top:6%;display:flex;justify-content:space-between;align-items:center;z-index:4; color:rgba(255,255,255,0.9);font-weight:700;font-size:16px; display:flex;gap:8px;align-items:center; }
  .location{display:flex;gap:8px;align-items:center}
  .loc-dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(180deg,#fff,#cbd5e1);box-shadow:0 2px 6px rgba(0,0,0,0.5)}
  .controls{display:flex;gap:8px;align-items:center}
  .unit-toggle{display:flex;gap:6px;background:transparent;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
  .unit-toggle button{background:transparent;border:0;padding:6px 8px;color:var(--muted);font-weight:700;border-radius:8px;cursor:pointer}
  .unit-toggle button.active{background:linear-gradient(90deg, rgba(250,204,21,0.12), rgba(125,211,252,0.06));color:var(--accent);box-shadow:0 6px 18px rgba(2,6,23,0.4)}
  .footer-ico{ position:absolute;bottom:8%;left:50%;transform:translateX(-50%);z-index:4;opacity:0.9; display:flex;align-items:center;justify-content:center; width:56px;height:56px;border-radius:56px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(2,6,23,0.5); }
  .aura{ position:absolute;inset:-12%; border-radius:50%; z-index:1; filter:blur(20px); background: radial-gradient(60% 50% at 50% 50%, rgba(124,58,237,0.05), transparent 30%); animation: pulse 3.6s ease-in-out infinite; pointer-events:none; }
  @keyframes pulse{ 0%{ transform:scale(.98); opacity:.9} 50%{ transform:scale(1.02); opacity:.7} 100%{ transform:scale(.98); opacity:.9} }
  .bubble-wrap.dragging{ transition: none; }
  .bubble-wrap.shrink{ transform: scale(.985); }
  @media (max-width:360px){ .temp{font-size:48px} .temp small{font-size:20px} .condition{font-size:15px} .minmax{font-size:12px} .stats{gap:8px;padding:6px 8px} }
  @media (prefers-reduced-motion: reduce) { .aura, .bubble { animation: none; transition: none; } }
  .bubble-wrap:focus { outline: 3px solid rgba(124,58,237,0.25); outline-offset: 6px; }
  .topbar div[style] > div:last-child { color: var(--muted); opacity: 0.98; }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Bubble weather overview">
    <noscript style="color:#9fb0c8;display:block;padding:8px;text-align:center">JavaScript is required to show live weather. Static preview shown.</noscript>
    <div class="bubble-wrap" id="bubbleWrap" tabindex="0" aria-label="Current weather" role="button">
      <div class="aura" aria-hidden="true"></div>
      <div class="bubble" id="bubble">
        <div class="topbar" id="topbar">
          <div class="location" id="location">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2C8 2 5 5 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-4-3-7-7-7z" stroke="#cbd5e1" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <div style="display:flex;flex-direction:column;line-height:1"><div style="font-weight:800">Ranchi</div><div id="updatedLabel" style="font-size:11px;color:var(--muted);font-weight:600" aria-live="polite">Updated 10m ago</div></div>
          </div>
          <div class="controls">
            <div class="unit-toggle" role="tablist" aria-label="Temperature units">
              <button id="btnC" class="active" aria-pressed="true">°C</button>
              <button id="btnF" aria-pressed="false">°F</button>
            </div>
          </div>
        </div>
        <div class="content" id="content">
          <div class="realfeel" id="realfeel">RealFeel® 25°</div>
          <div class="temp" id="temp">25<small id="unitLabel">°C</small></div>
          <div class="condition" id="condition">Hazy clouds</div>
          <div class="stats" role="group" aria-label="Weather details">
            <div class="stat"><div class="k" id="windVal">9.8 km/h</div><div class="t">Wind</div></div>
            <div class="stat"><div class="k" id="dirVal">E</div><div class="t">Dir</div></div>
            <div class="stat"><div class="k" id="humVal">63%</div><div class="t">Humidity</div></div>
          </div>
        </div>
        <div class="minmax left" aria-hidden="true" style="position:absolute;left:8.5%;top:42%"><div class="label">Low</div><div class="val" id="lowVal">19°</div></div>
        <div class="minmax right" aria-hidden="true" style="position:absolute;right:8.5%;top:42%"><div class="label">High</div><div class="val" id="highVal">30°</div></div>
        <div class="footer-ico" aria-hidden="true" title="Condition icon"><svg width="30" height="30" viewBox="0 0 24 24" fill="none"><path d="M3 15h18" stroke="#9dd3ff" stroke-width="1.6" stroke-linecap="round"/><path d="M3 18h18" stroke="#9dd3ff" stroke-width="1.6" stroke-linecap="round"/><path d="M6 12c1-2 4-3 6-2s3 3 6 3" stroke="#a0cfff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
      </div>
    </div>
  </div>
<script>
const sample={tempC:25,realFeelC:25,condition:'Hazy clouds',lowC:19,highC:30,windKmh:9.8,dir:'E',humidity:63,updatedAt:Date.now()};
const el=id=>document.getElementById(id);const btnC=el('btnC'),btnF=el('btnF');const TEMP_KEY='bubble_unit_pref_v1';
function getUnit(){return localStorage.getItem(TEMP_KEY)||'C'}function setUnit(u){localStorage.setItem(TEMP_KEY,u)}
function cToF(c){return Math.round((c*9/5)+32)}function kmhToMph(k){return Math.round(k*0.621371*10)/10}function mphToKmh(m){return Math.round((m/0.621371)*10)/10}
function formatTempForUnit(c,u){if(u==='C')return `${Math.round(c)}°`;return `${cToF(c)}°`}function formatWind(kmh,u){if(u==='C')return `${Math.round(kmh*10)/10} km/h`;else return `${kmhToMph(kmh)} mph`}
function humanUpdatedTime(ts){const diff=Math.round((Date.now()-ts)/60000);if(diff<=0)return 'Updated just now';if(diff===1)return 'Updated 1 min ago';if(diff<60)return `Updated ${diff} mins ago`;const hours=Math.round(diff/60);return `Updated ${hours} hr${hours>1?'s':''} ago`}
function renderData(){const unit=getUnit();el('unitLabel').textContent=unit==='C'?'°C':'°F';const tempEl=el('temp');const tempValue=unit==='C'?Math.round(sample.tempC):cToF(sample.tempC);tempEl.innerHTML=`${tempValue}<small id="unitLabel">${unit==='C'?'°C':'°F'}</small>`;el('realfeel').textContent=`RealFeel® ${formatTempForUnit(sample.realFeelC,unit)}`;el('condition').textContent=sample.condition;el('lowVal').textContent=formatTempForUnit(sample.lowC,unit);el('highVal').textContent=formatTempForUnit(sample.highC,unit);el('windVal').textContent=formatWind(sample.windKmh,unit);el('dirVal').textContent=sample.dir;el('humVal').textContent=`${Math.round(sample.humidity)}%`;el('updatedLabel').textContent=humanUpdatedTime(sample.updatedAt);if(unit==='C'){btnC.classList.add('active');btnC.setAttribute('aria-pressed','true');btnF.classList.remove('active');btnF.setAttribute('aria-pressed','false')}else{btnF.classList.add('active');btnF.setAttribute('aria-pressed','true');btnC.classList.remove('active');btnC.setAttribute('aria-pressed','false')}}
if(!localStorage.getItem(TEMP_KEY))setUnit('C');renderData();btnC.addEventListener('click',()=>{setUnit('C');renderData()});btnF.addEventListener('click',()=>{setUnit('F');renderData()});
const bubbleWrap=document.getElementById('bubbleWrap');const bubble=document.getElementById('bubble');bubbleWrap.addEventListener('click',()=>{bubble.classList.add('shrink');setTimeout(()=>bubble.classList.remove('shrink'),220);sample.tempC=Math.max(-30,Math.min(60,sample.tempC+Math.round((Math.random()*2-1)*10)/10));sample.lowC=Math.round(sample.tempC-(Math.random()*3+1));sample.highC=Math.round(sample.tempC+(Math.random()*2+3));sample.humidity=Math.max(10,Math.min(99,sample.humidity+Math.round((Math.random()-0.5)*8)));sample.windKmh=Math.max(0,Math.round((sample.windKmh+(Math.random()*2-1))*10)/10);sample.updatedAt=Date.now();renderData()});
let startX=0,startY=0,dragging=false;bubbleWrap.addEventListener('touchstart',(e)=>{dragging=true;const t=e.touches[0];startX=t.clientX;startY=t.clientY;bubbleWrap.classList.add('dragging')});bubbleWrap.addEventListener('touchmove',(e)=>{if(!dragging)return;const t=e.touches[0];const dx=(t.clientX-startX);const dy=(t.clientY-startY);const rx=Math.max(-8,Math.min(8,-dy/10));const ry=Math.max(-10,Math.min(10,dx/10));bubble.style.transform=`rotateX(${rx}deg) rotateY(${ry}deg) translateZ(0)`});bubbleWrap.addEventListener('touchend',()=>{dragging=false;bubbleWrap.classList.remove('dragging');bubble.style.transform=''});
bubbleWrap.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();bubbleWrap.click()}});
function updateFromAPI(data){Object.assign(sample,data);sample.updatedAt=Date.now();renderData()}
</script>
</body>
</html>
</template>

<template id="tpl-hourly">
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hourly Forecast — Fixed</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{ --bg1:#04050a; --bg2:#071026; --muted:#9fb0c8; --accent:#7c3aed; --accent2:#3b82f6; --glass: rgba(255,255,255,0.03); --gap:12px }
  html,body{height:100%;margin:0}
  body{ font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif; -webkit-font-smoothing:antialiased; background: linear-gradient(180deg,var(--bg1),var(--bg2)); display:flex;align-items:center;justify-content:center;padding:18px;color:#eaf2ff }
  .wrap{width:100%;max-width:420px}
  .card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:16px;border:1px solid rgba(255,255,255,0.04); padding:12px;box-shadow:0 12px 30px rgba(2,6,23,0.6);position:relative;overflow:visible }
  .card-head{display:flex;align-items:center;justify-content:space-between;padding-bottom:8px}
  .left{display:flex;align-items:center;gap:10px}
  .head-title{font-weight:700;font-size:16px}
  .head-sub{font-size:12px;color:var(--muted);margin-top:4px;font-weight:600}
  .controls{display:flex;align-items:center;gap:8px}
  .units{display:flex;gap:6px;border-radius:8px;padding:6px;background:transparent;border:1px solid rgba(255,255,255,0.02)}
  .units button{background:transparent;border:0;color:var(--muted);cursor:pointer;font-weight:700;padding:6px 8px;border-radius:8px}
  .units button.active{ background:linear-gradient(90deg, rgba(124,58,237,0.10), rgba(59,130,246,0.06)); color:var(--accent); box-shadow:0 6px 18px rgba(2,6,23,0.35) }
  .scroller-area{position:relative;display:flex;align-items:center;gap:8px}
  .nav-btn{ width:36px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,0.04); background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); color:var(--muted);display:flex;align-items:center;justify-content:center;cursor:pointer;margin:0 6px; box-shadow:0 8px 20px rgba(2,6,23,0.45) }
  .nav-btn:active{transform:translateY(1px)}
  .hours{ display:flex; gap:var(--gap); overflow-x:auto; padding:8px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch; overscroll-behavior-x: contain; touch-action: pan-x; scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.03) transparent }
  .hours::-webkit-scrollbar{height:8px}
  .hours::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.03);border-radius:8px}
  .hour{ scroll-snap-align:center; flex: 0 0 auto; width:92px; min-width:78px; background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center;justify-content:center; border:1px solid rgba(255,255,255,0.03); box-shadow: 0 6px 18px rgba(2,6,23,0.45); transition: transform .18s cubic-bezier(.2,.9,.2,1), box-shadow .18s, background .18s; user-select:none }
  .hour:active{ transform: translateY(2px) }
  .hour.focused{ transform: scale(1.06); box-shadow: 0 16px 36px rgba(2,6,23,0.6); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015)) }
  .time{font-weight:800;font-size:13px;margin-bottom:6px}
  .icon{width:36px;height:36px;margin-bottom:6px;display:flex;align-items:center;justify-content:center}
  .temp{font-weight:700;font-size:16px}
  .prec{font-size:11px;color:var(--muted);margin-top:6px}
  .center-indicator{ position:absolute;left:50%;transform:translateX(-50%);top:42%;width:110px;height:110px;border-radius:50%; pointer-events:none;border:1px dashed rgba(255,255,255,0.03);mix-blend-mode:overlay;opacity:0.12 }
  @media (max-width:360px){ .hour{width:78px;padding:8px} .icon{width:30px;height:30px} }
</style>
</head>
<body>
  <div class="wrap" role="region" aria-label="Hourly forecast (smooth horizontal)">
    <div class="card" role="group" aria-labelledby="hourlyTitle">
      <div class="card-head">
        <div class="left">
          <div aria-hidden="true" style="width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.03)"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="#cbd5e1" stroke-width="1.2"/><path d="M12 7v6l4 2" stroke="#cbd5e1" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          <div><div id="hourlyTitle" class="head-title">Hourly Forecast</div><div class="head-sub" id="headSub">Swipe or tap arrows</div></div>
        </div>
        <div class="controls" role="toolbar" aria-label="Forecast controls">
          <div class="units" role="tablist" aria-label="Temperature units"><button id="uC" aria-pressed="true" class="active">°C</button><button id="uF" aria-pressed="false">°F</button></div>
        </div>
      </div>
      <div class="scroller-area" aria-hidden="false">
        <button class="nav-btn" id="btnLeft" aria-label="Previous hours" title="Previous"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 6l-6 6 6 6" stroke="#cbd5e1" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="hours" id="hours" role="list" tabindex="0" aria-label="Hourly tiles"></div>
        <button class="nav-btn" id="btnRight" aria-label="Next hours" title="Next"><svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M9 6l6 6-6 6" stroke="#cbd5e1" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        <div class="center-indicator" aria-hidden="true"></div>
      </div>
    </div>
  </div>
<script>
const HOURS_EL=document.getElementById('hours');const BTN_LEFT=document.getElementById('btnLeft'),BTN_RIGHT=document.getElementById('btnRight');const UNIT_KEY='hourly_unit_v1';const BTN_C=document.getElementById('uC'),BTN_F=document.getElementById('uF');
function getUnit(){return localStorage.getItem(UNIT_KEY)||'C'}function setUnit(u){localStorage.setItem(UNIT_KEY,u)}function cToF(c){return Math.round((c*9/5)+32)}function fmtTemp(c,u){return u==='C'?`${Math.round(c)}°`:`${cToF(c)}°`}
function makeSampleHours(n=24){const out=[];const now=new Date();const baseTemp=22+Math.round((Math.random()-0.5)*4);for(let i=0;i<n;i++){const dt=new Date(now.getTime()+i*60*60*1000);const hr=dt.getHours();let cond='Clear';if(hr>=18||hr<=5)cond='Clear Night';if(hr>=6&&hr<=10)cond=Math.random()>0.8?'Fog':'Clear';if(hr>=11&&hr<=16)cond=Math.random()>0.8?'Clouds':'Sunny';if(Math.random()>0.92)cond='Rain';const temp=baseTemp+Math.round(Math.sin((i/12)*Math.PI)*3)+Math.round((Math.random()-0.5)*1.5);const precip=cond==='Rain'?60+Math.round(Math.random()*30):Math.round(Math.random()*20);out.push({timeLabel:dt.toLocaleTimeString([],{hour:'numeric',hour12:true}),hour24:dt.getHours(),tempC:temp,cond,precip,date:dt})}return out}
let samples=makeSampleHours(24);
function iconFor(cond,h24){const lc=cond.toLowerCase();if(lc.includes('rain'))return svgIcon('rain');if(lc.includes('fog'))return svgIcon('fog');const night=(h24>=18||h24<=5);if(lc.includes('clear')&&night)return svgIcon('moon');if(lc.includes('clear'))return svgIcon('sun');if(lc.includes('cloud'))return svgIcon('cloud');return svgIcon('sun')}
function svgIcon(n){if(n==='sun'){return `<svg viewBox="0 0 24 24" width="34" height="34" fill="none"><circle cx="12" cy="12" r="4.5" fill="#facc15"/><g stroke="#facc15" stroke-width="1.2" stroke-linecap="round"><path d="M12 2v2.8"/><path d="M12 21.2V24"/><path d="M4.93 4.93l1.98 1.98"/><path d="M17.09 17.09l1.98 1.98"/><path d="M2 12h2.8"/><path d="M19.2 12H22"/><path d="M4.93 19.07l1.98-1.98"/><path d="M17.09 6.91l1.98-1.98"/></g></svg>`}if(n==='moon'){return `<svg viewBox="0 0 24 24" width="34" height="34" fill="none"><path d="M21 12.79A8.999 8.999 0 0111.21 3 7 7 0 0021 12.79z" fill="#b6dfff"/></svg>`}if(n==='cloud'){return `<svg viewBox="0 0 24 24" width="34" height="34" fill="none"><path d="M20 17H7a4 4 0 010-8c.3 0 .6.02.9.06A6 6 0 0120 12a4 4 0 010 5z" fill="#cbd5e1" fill-opacity="0.12"/></svg>`}if(n==='rain'){return `<svg viewBox="0 0 24 24" width="34" height="34" fill="none"><path d="M20 16H6a4 4 0 010-8c.3 0 .6.02.9.06A6 6 0 0120 11a4 4 0 010 5z" fill="#cbd5e1" fill-opacity="0.06"/><g stroke="#60a5fa" stroke-width="1.6" stroke-linecap="round"><path d="M8 18l0 2"/><path d="M12 18l0 2"/><path d="M16 18l0 2"/></g></svg>`}if(n==='fog'){return `<svg viewBox="0 0 24 24" width="34" height="34" fill="none"><path d="M3 16h18M4 12h16M2 20h20" stroke="#9fb0c8" stroke-width="1.2" stroke-linecap="round"/></svg>`}return ''}
function renderTiles(){HOURS_EL.innerHTML='';const unit=getUnit();samples.forEach((h,i)=>{const div=document.createElement('div');div.className='hour';div.setAttribute('role','listitem');div.setAttribute('tabindex','0');div.innerHTML=`<div class="time">${h.timeLabel}</div><div class="icon" aria-hidden="true">${iconFor(h.cond,h.hour24)}</div><div class="temp">${fmtTemp(h.tempC,unit)}</div><div class="prec">${h.precip}%</div>`;div.addEventListener('click',()=>focusTile(div));div.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();div.click()}});HOURS_EL.appendChild(div)});requestAnimationFrame(()=>snapToCenterNearest())}
function focusTile(el){document.querySelectorAll('.hour').forEach(n=>n.classList.remove('focused'));el.classList.add('focused');const scrollerRect=HOURS_EL.getBoundingClientRect();const elRect=el.getBoundingClientRect();const scrollLeft=HOURS_EL.scrollLeft;const target=scrollLeft+(elRect.left+elRect.width/2)-(scrollerRect.left+scrollerRect.width/2);HOURS_EL.scrollTo({left:target,behavior:'smooth'})}
let scrollTimeout=null;HOURS_EL.addEventListener('scroll',()=>{document.querySelectorAll('.hour.focused').forEach(n=>n.classList.remove('focused'));if(scrollTimeout)clearTimeout(scrollTimeout);scrollTimeout=setTimeout(()=>{snapToCenterNearest()},110)});
function snapToCenterNearest(){const rect=HOURS_EL.getBoundingClientRect();const centerX=rect.left+rect.width/2;const tiles=Array.from(HOURS_EL.children);if(tiles.length===0)return;let nearest=tiles[0],minDist=Infinity,nearestIndex=0;tiles.forEach((t,idx)=>{const r=t.getBoundingClientRect();const c=r.left+r.width/2;const dist=Math.abs(c-centerX);if(dist<minDist){minDist=dist;nearest=t;nearestIndex=idx}});focusTile(nearest);setTimeout(()=>{tiles.forEach(t=>t.classList.remove('focused'));nearest.classList.add('focused')},320)}
BTN_LEFT.addEventListener('click',()=>{smoothScrollByTile(-1)});BTN_RIGHT.addEventListener('click',()=>{smoothScrollByTile(1)});
function smoothScrollByTile(direction){const tiles=Array.from(HOURS_EL.children);if(tiles.length===0)return;let idx=tiles.findIndex(t=>t.classList.contains('focused'));if(idx<0)idx=0;let next=idx+direction;next=Math.max(0,Math.min(tiles.length-1,next));focusTile(tiles[next])}
['touchstart','touchmove','touchend','pointerdown','pointermove','pointerup'].forEach(ev=>{HOURS_EL.addEventListener(ev,(e)=>{e.stopPropagation()},{passive:true})});
BTN_C.addEventListener('click',()=>{setUnit('C');BTN_C.classList.add('active');BTN_C.setAttribute('aria-pressed','true');BTN_F.classList.remove('active');BTN_F.setAttribute('aria-pressed','false');renderTiles();snapToCenterNearest()});BTN_F.addEventListener('click',()=>{setUnit('F');BTN_F.classList.add('active');BTN_F.setAttribute('aria-pressed','true');BTN_C.classList.remove('active');BTN_C.setAttribute('aria-pressed','false');renderTiles();snapToCenterNearest()});
window.addEventListener('resize',()=>{setTimeout(()=>snapToCenterNearest(),160)});
if(!localStorage.getItem(UNIT_KEY))setUnit('C');renderTiles();
setInterval(()=>{samples=samples.map(s=>({...s,tempC:Math.max(-20,s.tempC+(Math.random()-0.5)*1),precip:Math.max(0,Math.min(100,s.precip+Math.round((Math.random()-0.5)*6)))}));document.querySelectorAll('.hour').forEach((el,i)=>{const data=samples[i];if(!data)return;el.querySelector('.temp').textContent=fmtTemp(data.tempC,getUnit());el.querySelector('.prec').textContent=`${data.precip}%`})},60000);
</script>
</body>
</html>
</template>

<template id="tpl-daily">
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>10-Day Compact Forecast — Mobile</title>
<style>
  :root{ --bg1:#0f172a; --bg2:#1e293b; --card: rgba(255,255,255,0.03); --muted:#94a3b8; --accent:#facc15; --rain:#60a5fa }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{ font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: linear-gradient(180deg,var(--bg1),var(--bg2)); display:flex;align-items:center;justify-content:center;padding:14px; -webkit-font-smoothing:antialiased;color:#fff }
  .wrap{ width:100%;max-width:420px;background:#020617;border-radius:14px;border:1px solid #2b3947; overflow:hidden;box-shadow:0 8px 24px rgba(2,6,23,.6) }
  .head{ display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #273145 }
  .title{display:flex;gap:10px;align-items:center}
  .title h1{font-size:16px;font-weight:700}
  .subtitle{font-size:12px;color:var(--muted);margin-top:2px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{ background:#1f2a37;border:1px solid #334155;padding:6px 10px;border-radius:999px;font-size:12px;color:#e6eef8; cursor:pointer }
  .btn:active{transform:translateY(1px)}
  .unit-toggle{display:flex;gap:6px;align-items:center;font-size:12px;color:var(--muted)}
  .unit-toggle button{background:transparent;border:none;color:inherit;cursor:pointer;padding:6px;border-radius:8px}
  .unit-toggle button.active{background:rgba(250,204,21,0.12);color:var(--accent);font-weight:600}
  .list{padding:10px;display:flex;flex-direction:column;gap:8px;max-height:72vh;overflow:auto}
  .day{ background:var(--card);border-radius:10px;padding:8px;display:block;border:1px solid rgba(255,255,255,0.03); transition:transform .18s ease,box-shadow .18s ease }
  .day:active{transform:scale(.997)}
  .row{display:flex;align-items:center;gap:8px}
  .date{width:56px;font-size:12px;color:#e6eef8;font-weight:600}
  .dow{font-size:11px;color:var(--muted);margin-top:2px}
  .icon{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:8px}
  .condition{flex:1;min-width:0}
  .cond-main{font-size:13px;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .temps{font-size:13px;font-weight:700;min-width:56px;text-align:right}
  .details{ max-height:0;overflow:hidden;transition:max-height .36s cubic-bezier(.2,.9,.2,1),padding .18s; padding:0 6px }
  .day.open .details{padding:10px 6px 12px 6px}
  .day.open .details{max-height:220px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px;margin-bottom:8px}
  .meta .item{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px}
  .spark{width:100%;height:28px;display:flex;align-items:center}
  .spark svg{width:100%;height:28px;display:block}
  .prec{font-size:11px;color:var(--muted);margin-left:6px}
  .small{font-size:12px;color:var(--muted)}
  .accent{color:var(--accent);font-weight:700}
  .day:nth-child(even){background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00))}
  @media (max-width:360px){ .date{width:48px;font-size:11px} .title h1{font-size:15px} .temps{font-size:12px} .cond-main{font-size:12px} }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="10 day weather forecast">
    <div class="head">
      <div class="title" aria-hidden="false">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="3" stroke="#93a1b8" stroke-opacity=".12" fill="none"/><circle cx="12" cy="12" r="4" fill="#facc15" opacity=".95"/></svg>
        <div><h1>10-Day Forecast</h1><div class="subtitle">Clouds and sun — tap any day for details</div></div>
      </div>
      <div class="controls" aria-hidden="false">
        <div class="unit-toggle" role="tablist" aria-label="Temperature units"><button id="unit-c" class="active" aria-pressed="true">°C</button><button id="unit-f" aria-pressed="false">°F</button></div>
        <button class="btn" id="refreshBtn" title="Refresh sample data">Refresh</button>
      </div>
    </div>
    <div class="list" id="forecastList" role="list" aria-label="Ten day forecast list"></div>
  </div>
<script>
const sampleForecast=[
{date:'11/07',dow:'Thu',cond:'Sunny',hi:30,lo:19,precip:5,hourly:[22,24,26,28,30,29,27,25,23,21,20,19],sunrise:'06:08',sunset:'17:34',wind:'8 km/h',humidity:42},
{date:'11/08',dow:'Fri',cond:'Hazy sunshine',hi:29,lo:20,precip:10,hourly:[21,23,25,27,29,29,28,27,24,22,21,20],sunrise:'06:09',sunset:'17:33',wind:'10 km/h',humidity:46},
{date:'11/09',dow:'Sat',cond:'Partly sunny',hi:28,lo:19,precip:25,hourly:[20,22,24,26,28,27,26,25,23,21,20,19],sunrise:'06:10',sunset:'17:32',wind:'12 km/h',humidity:52},
{date:'11/10',dow:'Sun',cond:'Showers',hi:26,lo:20,precip:50,hourly:[20,20,21,22,24,25,24,23,22,21,20,20],sunrise:'06:11',sunset:'17:31',wind:'14 km/h',humidity:68},
{date:'11/11',dow:'Mon',cond:'Rainy',hi:25,lo:19,precip:60,hourly:[19,19,20,21,22,22,21,21,20,19,19,19],sunrise:'06:12',sunset:'17:30',wind:'16 km/h',humidity:74},
{date:'11/12',dow:'Tue',cond:'Sunny',hi:28,lo:18,precip:5,hourly:[18,20,22,24,26,27,26,25,24,22,20,18],sunrise:'06:13',sunset:'17:29',wind:'9 km/h',humidity:40},
{date:'11/13',dow:'Wed',cond:'Mostly sunny',hi:29,lo:19,precip:8,hourly:[19,21,23,25,27,28,27,26,25,23,21,19],sunrise:'06:14',sunset:'17:28',wind:'11 km/h',humidity:45},
{date:'11/14',dow:'Thu',cond:'Partly cloudy',hi:28,lo:18,precip:30,hourly:[18,19,21,23,26,26,25,24,23,22,20,19],sunrise:'06:15',sunset:'17:27',wind:'13 km/h',humidity:50},
{date:'11/15',dow:'Fri',cond:'Cloudy',hi:27,lo:20,precip:40,hourly:[20,20,21,22,24,25,24,23,22,21,20,20],sunrise:'06:16',sunset:'17:26',wind:'14 km/h',humidity:60},
{date:'11/16',dow:'Sat',cond:'Clear skies',hi:31,lo:19,precip:3,hourly:[22,24,26,28,30,31,30,28,26,24,22,21],sunrise:'06:17',sunset:'17:25',wind:'7 km/h',humidity:38}
];
const unitKey='pref_units_v1';function getUnit(){return localStorage.getItem(unitKey)||'C'}function setUnit(u){localStorage.setItem(unitKey,u)}function cToF(c){return Math.round((c*9/5)+32)}function formatTemp(valC,unit){if(unit==='C')return `${Math.round(valC)}°`;return `${cToF(valC)}°`}
function sparklineSVG(values){const w=200,h=28;const max=Math.max(...values),min=Math.min(...values);const range=(max-min)||1;const step=w/(values.length-1);const points=values.map((v,i)=>{const x=(i*step).toFixed(2);const y=(h-((v-min)/range*h)).toFixed(2);return `${x},${y}`}).join(' ');const poly=`<polyline points="${points}" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />`;return `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">${poly}</svg>`}
const listEl=document.getElementById('forecastList');const unitCBtn=document.getElementById('unit-c');const unitFBtn=document.getElementById('unit-f');const refreshBtn=document.getElementById('refreshBtn');
function render(forecast=sampleForecast){const unit=getUnit();if(unit==='C'){unitCBtn.classList.add('active');unitCBtn.setAttribute('aria-pressed','true');unitFBtn.classList.remove('active');unitFBtn.setAttribute('aria-pressed','false')}else{unitFBtn.classList.add('active');unitFBtn.setAttribute('aria-pressed','true');unitCBtn.classList.remove('active');unitCBtn.setAttribute('aria-pressed','false')}listEl.innerHTML='';forecast.forEach((d,idx)=>{const hi=formatTemp(d.hi,unit);const lo=formatTemp(d.lo,unit);const precip=d.precip;const day=document.createElement('article');day.className='day';day.setAttribute('role','listitem');day.innerHTML=`<div class="row" tabindex="0" role="button" aria-expanded="false"><div class="date" aria-hidden="true"><div>${d.date}</div><div class="dow">${d.dow}</div></div><div class="icon" aria-hidden="true">${iconSVG(d.cond,precip)}</div><div class="condition"><div class="cond-main">${d.cond} <span class="prec"> ${precip}%</span></div></div><div class="temps" aria-hidden="true"><span class="accent">${hi}</span> <span style="opacity:.6">/${lo}</span></div></div><div class="details" aria-hidden="true"><div class="meta"><div class="item">Sun ${d.sunrise} • ${d.sunset}</div><div class="item">Wind ${d.wind}</div><div class="item">Humidity ${d.humidity}%</div></div><div class="spark" aria-hidden="true">${sparklineSVG(d.hourly)}</div><div style="display:flex;justify-content:space-between;margin-top:8px;font-size:12px;color:var(--muted)"><div>Hourly (local)</div><div>High/Low: ${hi} / ${lo}</div></div></div>`;const header=day.querySelector('.row');const details=day.querySelector('.details');header.addEventListener('click',()=>toggle(day,header,details));header.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();toggle(day,header,details)}});listEl.appendChild(day)})}
function toggle(dayEl,header,details){const isOpen=dayEl.classList.contains('open');if(isOpen){dayEl.classList.remove('open');header.setAttribute('aria-expanded','false');details.setAttribute('aria-hidden','true')}else{const openNow=document.querySelector('.day.open');if(openNow){openNow.classList.remove('open');openNow.querySelector('.row').setAttribute('aria-expanded','false');openNow.querySelector('.details').setAttribute('aria-hidden','true')}dayEl.classList.add('open');header.setAttribute('aria-expanded','true');details.setAttribute('aria-hidden','false');setTimeout(()=>dayEl.scrollIntoView({behavior:'smooth',block:'center'}),150)}}
function iconSVG(cond,precip){const lc=cond.toLowerCase();if(lc.includes('sun')||lc.includes('clear')){return `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" fill="#facc15" /></svg>`}if(lc.includes('partly')||lc.includes('cloud')){return `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z" fill="#cbd5e1" fill-opacity="0.06"/></svg>`}if(lc.includes('rain')||lc.includes('shower')){return `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" fill="#60a5fa" fill-opacity="0.08"/></svg>`}return `<svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="5" fill="#9ca3af" fill-opacity="0.06"/></svg>`}
unitCBtn.addEventListener('click',()=>{setUnit('C');render()});unitFBtn.addEventListener('click',()=>{setUnit('F');render()});refreshBtn.addEventListener('click',()=>{sampleForecast.forEach(d=>{d.hourly=d.hourly.map(v=>Math.max(10,Math.round(v+(Math.random()-0.5)*3)));d.hi=Math.max(d.lo+1,Math.round(Math.max(...d.hourly)));d.lo=Math.min(...d.hourly);d.precip=Math.max(0,Math.min(99,d.precip+Math.round((Math.random()-0.5)*12))) });render()});if(!localStorage.getItem(unitKey))setUnit('C');render();
</script>
</body>
</html>
</template>

<template id="tpl-air">
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Air Quality — Mobile App Card</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg-1:#020617; --bg-2:#071126; --muted:#9fb0c8; --glass: rgba(255,255,255,0.03); --accent:#f59e0b; --accent2:#3b82f6; --card-radius:18px; --padding:14px }
  html,body{height:100%;margin:0}
  body{ font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,sans-serif; -webkit-font-smoothing:antialiased; background: linear-gradient(180deg,var(--bg-1),var(--bg-2)); display:flex;align-items:center;justify-content:center;padding:12px;color:#eaf2ff; -webkit-touch-callout:none; -webkit-user-select:none; user-select:none }
  .card{ width:100%; max-width:420px; border-radius:var(--card-radius); background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006)); padding:var(--padding); border:1px solid rgba(255,255,255,0.04); box-shadow: 0 18px 40px rgba(2,6,23,0.6); display:flex;flex-direction:column;gap:12px; overflow:hidden }
  .header{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .title{display:flex;align-items:center;gap:10px}
  .logo{ width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.03) }
  .label{font-weight:800;font-size:18px}
  .subtitle{color:var(--muted);font-weight:600;font-size:12px}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{ padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04); background:transparent;color:var(--muted);font-weight:700;font-size:13px;cursor:pointer }
  .btn.primary{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#071026;border:none}
  .main{ display:flex;flex-direction:column;gap:10px;align-items:center; padding:8px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03) }
  .aqi-row{ display:flex;flex-direction:row;align-items:center;gap:12px;width:100%;justify-content:space-between }
  .aqi-box{ display:flex;flex-direction:column;align-items:flex-start;gap:6px;padding-left:6px }
  .aqi-value{font-size:48px;font-weight:900;line-height:1}
  .aqi-category{font-weight:700;color:var(--muted);font-size:13px}
  .bubble{flex:1;display:flex;flex-direction:column;gap:8px;width:100%}
  .scale{ height:12px;border-radius:999px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.03); background: linear-gradient(90deg,#10b981 0%, #f59e0b 33%, #f97316 50%, #ef4444 70%, #a855f7 90%); width:100% }
  .thumb{ position:absolute;top:50%;transform:translate(-50%,-50%);width:18px;height:18px;border-radius:50%;border:3px solid #fff; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18), rgba(255,255,255,0.02)); transition:left .45s cubic-bezier(.2,.9,.2,1); box-shadow:0 8px 18px rgba(2,6,23,0.45) }
  .scale-labels{display:flex;justify-content:space-between;color:var(--muted);font-weight:700;font-size:11px;margin-top:6px}
  .pol-list{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;justify-content:space-between}
  .pol{ flex:0 0 calc(33% - 8px); min-width:88px;background:rgba(255,255,255,0.02);border-radius:10px;padding:8px;border:1px solid rgba(255,255,255,0.02);text-align:center }
  .pol small{color:var(--muted);font-weight:700}
  .pol .val{font-weight:800;font-size:18px;margin-top:6px}
  .spark-wrap{width:100%;height:44px;margin-top:6px;display:flex;align-items:center;justify-content:center}
  #spark{width:100%;height:44px}
  .advice{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02);font-weight:700;font-size:13px}
  .ad-dot{width:10px;height:10px;border-radius:50%}
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(0,0,0,0.5), rgba(0,0,0,0.5));z-index:1200}
  .panel{width:92%;max-width:420px;background:linear-gradient(180deg,#020617,#071126);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);color:#eaf2ff}
  canvas#exportCanvas{display:none}
  @media (max-width:360px){ .aqi-value{font-size:42px} .pol{flex:0 0 calc(50% - 8px);min-width:120px} }
</style>
</head>
<body>
  <div class="card" id="aqCard" role="article" aria-label="Air quality card">
    <div class="header">
      <div class="title"><div class="logo" aria-hidden="true"><svg width="22" height="22" viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="16" rx="3" ry="3" stroke="#cbd5e1" stroke-width="1.2" fill="none" /><path d="M7 8h10" stroke="#cbd5e1" stroke-width="1.2" stroke-linecap="round"/></svg></div><div><div class="label">Air Quality</div><div class="subtitle" id="locLabel">Ranchi · Updated now</div></div></div>
      <div class="controls"><button class="btn" id="infoBtn" aria-label="info">i</button><button class="btn" id="exportBtn" aria-label="export">Export</button><button class="btn primary" id="saveBtn" aria-pressed="false">Save</button></div>
    </div>
    <div class="main" id="mainBlock">
      <div class="aqi-row"><div class="aqi-box"><div class="small">AQI</div><div class="aqi-value" id="aqValue">100</div><div class="aqi-category" id="aqCategory">Moderate</div><div class="small" style="margin-top:6px">Main Pollutant: <span id="mainPoll">PM2_5</span></div></div>
        <div class="bubble" style="align-items:stretch"><div style="display:flex;align-items:center;justify-content:space-between;gap:8px"><div style="flex:1"><div class="scale" id="aqScale" role="img" aria-label="AQI scale"><div class="thumb" id="scaleThumb" style="left:45%"></div></div><div class="scale-labels"><div>Good</div><div>Fair</div><div>Unhealthy</div><div>Very</div><div>Hazard</div></div></div><div style="width:110px;display:flex;flex-direction:column;gap:6px;align-items:flex-end"><div class="small">Trend</div><div class="spark-wrap"><svg id="spark" viewBox="0 0 220 44" preserveAspectRatio="none"></svg></div><div class="small" id="windVal">E 9.8 km/h</div></div></div><div class="pol-list" id="polList" aria-hidden="false"></div></div>
      </div>
    <div class="advice"><div class="ad-dot" id="adDot" style="background:#f59e0b"></div><div id="adText">Air quality is moderate. Sensitive people should reduce prolonged outdoor exertion.</div></div>
  </div>
  <div class="modal" id="modal" aria-hidden="true"><div class="panel" role="document"><button class="btn" id="modalClose" style="float:right">Close</button><h3>Air Quality — Info</h3><p style="color:var(--muted);margin-top:6px">AQI (Air Quality Index) is based on pollutants like PM2.5, PM10, NO₂, SO₂, CO and O₃. Values: 0–50 Good, 51–100 Moderate, 101–150 Unhealthy for Sensitive, 151–200 Unhealthy, 201+ Very Unhealthy / Hazardous.</p></div></div>
  <canvas id="exportCanvas" width="1080" height="1920"></canvas>
<script>
let sampleAQ={aqi:100,category:'Moderate',mainPollutant:'PM2_5',wind:'E 9.8 km/h',trend:[90,92,95,98,100,102,101,100],pollutants:[{code:'NO2',value:51,color:'#f59e0b'},{code:'O3',value:11,color:'#10b981'},{code:'PM10',value:69,color:'#f59e0b'},{code:'PM2_5',value:100,color:'#ef4444'},{code:'CO',value:3,color:'#10b981'},{code:'SO2',value:15,color:'#10b981'}]};
const $=id=>document.getElementById(id);function clamp(v,a,b){return Math.max(a,Math.min(b,v))}function mapRange(v,inMin,inMax,outMin,outMax){return outMin+(outMax-outMin)*((v-inMin)/(inMax-inMin))}
function aqiCategory(aqi){if(aqi<=50)return{cat:'Good',color:'#10b981'};if(aqi<=100)return{cat:'Moderate',color:'#f59e0b'};if(aqi<=150)return{cat:'Unhealthy-SG',color:'#f97316'};if(aqi<=200)return{cat:'Unhealthy',color:'#ef4444'};if(aqi<=300)return{cat:'Very Unhealthy',color:'#8b5cf6'};return{cat:'Hazardous',color:'#7e22ce'}}
function healthAdvice(aqi){if(aqi<=50)return{text:'Air quality is good. Enjoy your day!',color:'#10b981'};if(aqi<=100)return{text:'Moderate air quality. Sensitive groups should take care.',color:'#f59e0b'};if(aqi<=150)return{text:'Unhealthy for sensitive groups. Limit prolonged exertion.',color:'#f97316'};if(aqi<=200)return{text:'Unhealthy. Reduce outdoor activities.',color:'#ef4444'};if(aqi<=300)return{text:'Very unhealthy. Avoid outdoor exertion.',color:'#8b5cf6'};return{text:'Hazardous. Stay indoors and follow local guidance.',color:'#7e22ce'}}
function renderCard(data){$('aqValue').textContent=data.aqi;const cat=aqiCategory(data.aqi);$('aqCategory').textContent=cat.cat;$('aqCategory').style.color=cat.color;$('mainPoll').textContent=data.mainPollutant.replace('_','.');$('windVal').textContent=data.wind;$('locLabel').textContent='Ranchi · Updated just now';const pct=clamp(mapRange(data.aqi,0,500,0,100),0,100);$('scaleThumb').style.left=pct+'%';drawSpark(data.trend);const polList=$('polList');polList.innerHTML='';data.pollutants.forEach(p=>{const node=document.createElement('div');node.className='pol';const intensity=Math.round(mapRange(clamp(p.value,0,200),0,200,12,100));node.innerHTML=`<small>${p.code.replace('_','.')}</small><div class="val" style="color:${p.color}">${p.value}</div><div style="width:100%;height:8px;border-radius:8px;background:rgba(255,255,255,0.03);margin-top:6px;display:flex;align-items:center"><div style="width:${intensity}%;height:6px;border-radius:6px;background:${p.color}"></div></div>`;polList.appendChild(node)});const advice=healthAdvice(data.aqi);$('adText').textContent=advice.text;$('adDot').style.background=advice.color}
function drawSpark(values){const svg=$('spark');const w=svg.viewBox.baseVal.width||220;const h=svg.viewBox.baseVal.height||44;const max=Math.max(...values);const min=Math.min(...values);const pad=6;const points=values.map((v,i)=>{const x=mapRange(i,0,values.length-1,pad,w-pad);const y=mapRange(v,min,max,pad,h-pad);return `${x},${h-y}`}).join(' ');const gId='gSpark';svg.innerHTML=`<defs><linearGradient id="${gId}" x1="0" x2="1"><stop offset="0%" stop-color="#7c3aed" stop-opacity="0.14"/><stop offset="100%" stop-color="#3b82f6" stop-opacity="0.22"/></linearGradient></defs><polyline points="${points}" fill="none" stroke="url(#${gId})" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />`}
function exportCardPNG(){const canvas=$('exportCanvas');const ctx=canvas.getContext('2d');const W=canvas.width=1080;const H=canvas.height=1920;ctx.clearRect(0,0,W,H);const bg=ctx.createLinearGradient(0,0,0,H);bg.addColorStop(0,'#071026');bg.addColorStop(1,'#020617');ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);const margin=60;const cardW=W-margin*2;const cardH=H-margin*2;ctx.beginPath();const r=36;ctx.moveTo(margin+r,margin);ctx.arcTo(margin+cardW,margin,margin+cardW,margin+cardH,r);ctx.arcTo(margin+cardW,margin+cardH,margin,margin+cardH,r);ctx.arcTo(margin,margin+cardH,margin,margin,r);ctx.arcTo(margin,margin,margin+cardW,margin,r);ctx.closePath();ctx.fillStyle='rgba(255,255,255,0.02)';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=3;ctx.stroke();ctx.fillStyle='#eaf4ff';ctx.font='900 140px Inter, Arial';ctx.textBaseline='top';ctx.fillText(String(sampleAQ.aqi),margin+60,margin+60);const cat=aqiCategory(sampleAQ.aqi);ctx.font='700 36px Inter, Arial';ctx.fillStyle=cat.color;ctx.fillText(cat.cat,margin+360,margin+88);ctx.font='600 22px Inter, Arial';ctx.fillStyle='#cfe8ff';ctx.fillText('Main Pollutant: '+sampleAQ.mainPollutant.replace('_','.'),margin+60,margin+220);const scaleX=margin+60,scaleY=margin+300,scaleW=cardW-120,scaleH=26;const g=ctx.createLinearGradient(scaleX,0,scaleX+scaleW,0);g.addColorStop(0,'#10b981');g.addColorStop(0.3,'#f59e0b');g.addColorStop(0.5,'#f97316');g.addColorStop(0.7,'#ef4444');g.addColorStop(0.9,'#8b5cf6');ctx.fillStyle=g;roundRect(ctx,scaleX,scaleY,scaleW,scaleH,16);ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=2;ctx.stroke();const pct=clamp(mapRange(sampleAQ.aqi,0,500,0,1),0,1);const thumbX=scaleX+pct*scaleW;ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(thumbX,scaleY+scaleH/2,18,0,Math.PI*2);ctx.fill();ctx.strokeStyle='rgba(0,0,0,0.2)';ctx.lineWidth=3;ctx.stroke();const boxTop=scaleY+80;const boxW=Math.floor((cardW-140)/3);sampleAQ.pollutants.forEach((p,i)=>{const col=i%3;const row=Math.floor(i/3);const x=margin+60+col*(boxW+20);const y=boxTop+row*(120);roundRect(ctx,x,y,boxW,100,12);ctx.fillStyle='rgba(255,255,255,0.02)';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.03)';ctx.stroke();ctx.fillStyle=p.color;ctx.font='800 40px Inter, Arial';ctx.fillText(String(p.value),x+18,y+18);ctx.fillStyle='#cfe8ff';ctx.font='600 18px Inter, Arial';ctx.fillText(p.code.replace('_','.'),x+18,y+60)});ctx.fillStyle='#9fb0c8';ctx.font='500 18px Inter, Arial';ctx.fillText('Air Quality • Generated by MyWeather',margin+60,margin+cardH-60);const url=canvas.toDataURL('image/png');const a=document.createElement('a');a.href=url;a.download=`aqi-${sampleAQ.aqi}.png`;a.click()}
function roundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath()}
$('infoBtn').addEventListener('click',()=>{$('modal').style.display='flex';$('modal').setAttribute('aria-hidden','false')});$('modalClose').addEventListener('click',()=>{$('modal').style.display='none';$('modal').setAttribute('aria-hidden','true')});$('exportBtn').addEventListener('click',()=>{$('exportBtn').textContent='Exporting...';setTimeout(()=>{exportCardPNG();$('exportBtn').textContent='Export'},220)});$('saveBtn').addEventListener('click',(e)=>{const btn=e.currentTarget;const pressed=btn.getAttribute('aria-pressed')==='true';btn.setAttribute('aria-pressed',String(!pressed));btn.textContent=!pressed?'Saved':'Save'});
function init(){sampleAQ=sampleAQ||sampleAQ;renderCard(sampleAQ)}
init();
setInterval(()=>{sampleAQ.aqi=Math.max(5,Math.min(350,Math.round(sampleAQ.aqi+(Math.random()-0.5)*12)));sampleAQ.pollutants.forEach(p=>p.value=Math.max(0,Math.round(p.value+(Math.random()-0.5)*6)));sampleAQ.pollutants.sort((a,b)=>b.value-a.value);sampleAQ.mainPollutant=sampleAQ.pollutants[0].code;sampleAQ.trend.push(sampleAQ.aqi);if(sampleAQ.trend.length>12)sampleAQ.trend.shift();sampleAQ.wind=['E','NE','N','W','SW'][Math.floor(Math.random()*5)]+' '+(4+Math.round(Math.random()*14))+' km/h';renderCard(sampleAQ)},4500);
</script>
</body>
</html>
</template>

<template id="tpl-metrics">
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Weather Metrics — Mobile Widgets (With Export & Extra)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg1:#04050a; --bg2:#071026; --card-bg: rgba(255,255,255,0.02); --glass-border: rgba(255,255,255,0.04); --muted:#9fb0c8; --accent:#3b82f6; --radius:14px }
  html,body{height:100%;margin:0}
  body{ display:flex;align-items:center;justify-content:center; background:linear-gradient(180deg,var(--bg1),var(--bg2)); font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,sans-serif; color:#eaf2ff;padding:14px;-webkit-font-smoothing:antialiased }
  .container { width:100%; max-width:420px; display:flex; flex-direction:column; gap:10px }
  .topbar { display:flex; justify-content:space-between; align-items:center; gap:8px }
  .ref { color:var(--muted); font-weight:700; font-size:12px }
  .export-btn { padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:linear-gradient(90deg,var(--accent),#7c3aed); color:#fff; font-weight:800; cursor:pointer; box-shadow:0 8px 20px rgba(2,6,23,0.45) }
  .grid { width:100%; display:grid; gap:12px; grid-template-columns: repeat(2, 1fr) }
  .card { background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006)); border:1px solid var(--glass-border); border-radius:var(--radius); padding:12px; box-shadow: 0 16px 36px rgba(2,6,23,0.6); min-height:140px; display:flex;flex-direction:column;justify-content:space-between; overflow:hidden }
  .card .head { display:flex;justify-content:space-between;align-items:center; gap:8px; margin-bottom:6px }
  .card .title{ font-weight:800; font-size:13px; letter-spacing:0.3px }
  .card .sub{ color:var(--muted); font-weight:700; font-size:11px }
  .gauge-wrap { display:flex;align-items:center;gap:12px }
  .gauge { width:110px; height:80px; display:block }
  .gauge .centre { text-align:center; font-weight:800; font-size:20px }
  .gauge .units { color:var(--muted); font-size:12px; margin-top:4px }
  .compass { width:100%; display:flex; align-items:center; gap:10px; justify-content:space-between }
  .compass-svg { width:110px; height:110px }
  .wind-value { text-align:center; font-weight:800; font-size:22px }
  .wind-units { color:var(--muted); font-weight:700; font-size:12px }
  .centered { display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px }
  .big { font-weight:900; font-size:44px; line-height:1 }
  .desc { color:var(--muted); font-weight:700; font-size:12px; text-align:center }
  .uv-track { width:100%; height:10px; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,0.03) }
  .uv-thumb { position:relative; width:18px; height:18px; border-radius:50%; background:#fff; transform:translateX(-50%); top:-4px; box-shadow:0 10px 20px rgba(2,6,23,0.4) }
  .uv-labels { display:flex; justify-content:space-between; font-weight:700; color:var(--muted); font-size:11px; margin-top:6px }
  .advice { font-size:12px; color:var(--muted); text-align:center; margin-top:6px; font-weight:700 }
  .pol { flex:0 0 calc(33% - 8px); min-width:88px; background:rgba(255,255,255,0.02); border-radius:10px; padding:8px; border:1px solid rgba(255,255,255,0.02); text-align:center }
  .pol small{ color:var(--muted); font-weight:700 }
  .pol .val{ font-weight:800; font-size:18px }
  .controls { grid-column: 1 / -1; display:flex; gap:8px; justify-content:center; margin-top:6px }
  .btn { padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:var(--muted); font-weight:800; cursor:pointer }
  .btn.primary { background:linear-gradient(90deg,var(--accent),#7c3aed); color:#fff; border:none; box-shadow:0 10px 30px rgba(2,6,23,0.5) }
  @media (max-width:360px){ .big{font-size:36px} .gauge{width:94px;height:68px} }
</style>
</head>
<body>
  <div class="container">
    <div class="topbar"><div class="ref" id="dataRef">Data source: Sample • Replace with API</div><button class="export-btn" id="topExportBtn">Export PNG</button></div>
    <div class="grid" role="region" aria-label="Weather metrics grid">
      <div class="card" id="pressureCard" role="article" aria-label="Pressure">
        <div class="head"><div><div class="title">PRESSURE</div><div class="sub">mbar</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 12h18" stroke="#cbd5e1" stroke-width="1.4" stroke-linecap="round"/></svg></div>
        <div class="gauge-wrap" style="align-items:center">
          <svg class="gauge" id="pressureGauge" viewBox="0 0 200 120" aria-hidden="true"><defs><linearGradient id="gPressure" x1="0" x2="1"><stop offset="0%" stop-color="#10b981"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#ef4444"/></linearGradient></defs><path d="M20 100 A80 80 0 0 1 180 100" fill="none" stroke="rgba(255,255,255,0.04)" stroke-width="12" stroke-linecap="round"/><path id="pressureArc" d="M20 100 A80 80 0 0 1 180 100" fill="none" stroke="url(#gPressure)" stroke-width="12" stroke-linecap="round" stroke-dasharray="502" stroke-dashoffset="502"/><g transform="translate(100,100)" id="needleGroup"><line x1="0" y1="0" x2="0" y2="-68" stroke="#fff" stroke-width="3" stroke-linecap="round" /><circle cx="0" cy="0" r="6" fill="#fff"/></g></svg>
          <div style="flex:1"><div class="gauge centre"><div id="pressureValue" style="font-size:18px;font-weight:900">1015</div><div class="units">mbar</div></div><div style="display:flex;justify-content:space-between;margin-top:6px;font-weight:800;color:var(--muted)"><div id="pressureLow">Low</div><div id="pressureHigh">High</div></div></div>
        </div>
      </div>
      <div class="card" id="windCard" role="article" aria-label="Wind">
        <div class="head"><div><div class="title">WIND</div><div class="sub" id="windDirText">E 9.8 km/h</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v20" stroke="#cbd5e1" stroke-width="1.4" stroke-linecap="round"/></svg></div>
        <div class="compass">
          <svg class="compass-svg" viewBox="0 0 220 220" id="compassSVG" aria-hidden="true"><circle cx="110" cy="110" r="96" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="10"/><text x="110" y="24" text-anchor="middle" font-weight="800" fill="#cfe8ff">N</text><text x="110" y="208" text-anchor="middle" font-weight="800" fill="#cfe8ff">S</text><text x="208" y="114" text-anchor="middle" font-weight="800" fill="#cfe8ff">E</text><text x="12" y="114" text-anchor="middle" font-weight="800" fill="#cfe8ff">W</text><g id="windNeedle" transform="translate(110,110) rotate(0)"><path d="M0,-70 L8,-50 L0,-60 L-8,-50 Z" fill="#7c3aed" /><circle cx="0" cy="0" r="6" fill="#fff" /><line x1="0" y1="0" x2="60" y2="0" stroke="rgba(255,255,255,0.06)" stroke-width="2"/></g></svg>
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center"><div class="wind-value" id="windSpeed">9.8</div><div class="wind-units">km/h</div><div class="advice" style="margin-top:8px">Gusts: <strong id="gustText" style="margin-left:6px;color:#cfe8ff">12 km/h</strong></div></div>
        </div>
      </div>
      <div class="card" id="uvCard" role="article" aria-label="UV Index">
        <div class="head"><div><div class="title">UV INDEX</div><div class="sub">Risk level</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="12" cy="12" r="5" stroke="#cbd5e1" stroke-width="1.2"/></svg></div>
        <div class="centered"><div class="big" id="uvValue">0</div><div class="desc" id="uvDesc">Low</div><div style="width:100%;margin-top:6px"><div class="uv-track" id="uvTrack" style="background:linear-gradient(90deg,#10b981,#f59e0b,#f97316,#ef4444,#8b5cf6)"><div id="uvThumb" class="uv-thumb" style="left:6%"></div></div><div class="uv-labels"><div>0</div><div>2</div><div>4</div><div>6</div><div>11+</div></div></div><div class="advice" id="uvAdvice">Continued to remain at lower levels.</div></div>
      </div>
      <div class="card" id="visCard" role="article" aria-label="Visibility">
        <div class="head"><div><div class="title">VISIBILITY</div><div class="sub">km</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M2 12h20" stroke="#cbd5e1" stroke-width="1.4"/></svg></div>
        <div class="centered"><div class="big" id="visVal">4.8</div><div class="desc" id="visText">Poor visibility, unclear field of view</div></div>
      </div>
      <div class="card" id="precipCard" role="article" aria-label="Precipitation">
        <div class="head"><div><div class="title">PRECIPITATION</div><div class="sub">chance & amount</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v14" stroke="#cbd5e1" stroke-width="1.4"/></svg></div>
        <div class="centered"><div class="big" id="precipVal">25%</div><div class="desc" id="precipText">Light showers expected • 1.2 mm</div></div>
      </div>
      <div class="card" id="humCard" role="article" aria-label="Humidity">
        <div class="head"><div><div class="title">HUMIDITY</div><div class="sub">relative</div></div><svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2c0 6-6 8-6 12a6 6 0 0012 0c0-4-6-6-6-12z" stroke="#cbd5e1" stroke-width="1.2" fill="none"/></svg></div>
        <div class="centered"><div class="big" id="humVal">68%</div><div class="desc" id="humText">Feels humid • May feel warmer</div></div>
      </div>
    </div>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:6px"><button class="btn" id="refreshBtn">Refresh</button><button class="btn primary" id="exportBtn">Export PNG</button></div>
  </div>
  <canvas id="exportCanvas" width="1080" height="1920" style="display:none"></canvas>
<script>
let sample={pressure:1015,pressureRange:[995,1035],windSpeed:9.8,windDir:270,gust:12,uv:0,visibility:4.8,precipChance:25,precipAmount:1.2,humidity:68};
const $=id=>document.getElementById(id);function clamp(v,a,b){return Math.max(a,Math.min(b,v))}function mapRange(v,inMin,inMax,outMin,outMax){return outMin+(outMax-outMin)*((v-inMin)/(inMax-inMin))}function degToCardinal(d){const dirs=['N','NE','E','SE','S','SW','W','NW','N'];const ix=Math.round((d%360)/45);return dirs[ix]}function aqiCategoryNotUsed(){}
function renderPressure(){const p=sample.pressure;const minP=960,maxP=1040;const pct=clamp(mapRange(p,minP,maxP,0,1),0,1);const arc=$('pressureArc');const total=502;arc.style.transition='stroke-dashoffset 700ms cubic-bezier(.2,.9,.2,1)';arc.style.strokeDashoffset=total*(1-pct);const angle=mapRange(p,minP,maxP,-90,90);$('needleGroup').style.transform=`translate(100px,100px) rotate(${angle}deg)`;$('pressureValue').textContent=p;$('pressureLow').textContent=sample.pressureRange[0];$('pressureHigh').textContent=sample.pressureRange[1]}
function renderWind(){const speed=sample.windSpeed;const dir=sample.windDir;$('windSpeed').textContent=parseFloat(speed).toFixed(1);$('windDirText').textContent=`${degToCardinal(dir)} · ${parseFloat(speed).toFixed(1)} km/h`;$('gustText').textContent=`${sample.gust} km/h`;$('windNeedle').style.transition='transform 600ms cubic-bezier(.2,.9,.2,1)';$('windNeedle').style.transform=`translate(110,110) rotate(${dir}deg)`}
function renderUV(){const uv=sample.uv;$('uvValue').textContent=uv;let desc='Low';if(uv<=2)desc='Low';else if(uv<=5)desc='Moderate';else if(uv<=7)desc='High';else if(uv<=10)desc='Very High';else desc='Extreme';$('uvDesc').textContent=desc;const pct=clamp(mapRange(uv,0,11,0,100),0,100);$('uvThumb').style.left=pct+'%';$('uvAdvice').textContent=uv<=2?'Continued to remain at lower levels.':uv<=5?'Use sunglasses and sunscreen':'Take extra precautions.'}
function renderVis(){ $('visVal').textContent=(Math.round(sample.visibility*10)/10).toString(); let txt='Visibility good'; if(sample.visibility<1)txt='Very poor visibility'; else if(sample.visibility<5)txt='Poor visibility, unclear field of view'; else if(sample.visibility<10)txt='Moderate visibility'; $('visText').textContent=txt }
function renderPrecipHum(){ $('precipVal').textContent=sample.precipChance+'%'; $('precipText').textContent=`${sample.precipChance}% chance • ${sample.precipAmount} mm`; $('humVal').textContent=sample.humidity+'%'; $('humText').textContent=sample.humidity>80?'Very humid • May feel warmer':sample.humidity>60?'Feels humid • Might feel warmer':'Comfortable humidity' }
function drawSparkTrend(){const svg=document.getElementById('spark');if(!svg)return;const vals=sample.trend||[90,92,95,98,100,102,101,100];const w=220,h=44;const max=Math.max(...vals),min=Math.min(...vals);const pad=6;const points=vals.map((v,i)=>{const x=mapRange(i,0,vals.length-1,pad,w-pad);const y=mapRange(v,min,max,pad,h-pad);return `${x},${h-y}`}).join(' ');svg.innerHTML=`<polyline points="${points}" fill="none" stroke="#7c3aed" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" stroke-opacity="0.9"/>`}
function renderAll(){renderPressure();renderWind();renderUV();renderVis();renderPrecipHum();drawSparkTrend()}
function exportGridPNG(){const canvas=$('exportCanvas');const ctx=canvas.getContext('2d');const W=canvas.width=1080;const H=canvas.height=1920;ctx.clearRect(0,0,W,H);const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,'#071026');g.addColorStop(1,'#020617');ctx.fillStyle=g;ctx.fillRect(0,0,W,H);ctx.fillStyle='#eaf4ff';ctx.font='700 44px Inter, Arial';ctx.fillText('Weather Metrics',60,80);ctx.font='500 20px Inter, Arial';ctx.fillStyle='#9fb0c8';ctx.fillText('Data source: Sample • Replace with API',60,118);const px=60,py=160;const pad=28;const cardW=Math.floor((W-px*2-pad)/2);const cardH=360;const boxes=[{title:'Pressure',body:sample.pressure+' mbar'},{title:'Wind',body:`${sample.windSpeed} km/h · ${degToCardinal(sample.windDir)}`},{title:'UV Index',body:`${sample.uv} · ${$('uvDesc').textContent}`},{title:'Visibility',body:`${sample.visibility} km`},{title:'Precipitation',body:`${sample.precipChance}% · ${sample.precipAmount} mm`},{title:'Humidity',body:`${sample.humidity}%` }];boxes.forEach((b,i)=>{const col=i%2;const row=Math.floor(i/2);const x=px+col*(cardW+pad);const y=py+row*(cardH+pad/2);roundRect(ctx,x,y,cardW,cardH,24);ctx.fillStyle='rgba(255,255,255,0.02)';ctx.fill();ctx.strokeStyle='rgba(255,255,255,0.04)';ctx.lineWidth=2;ctx.stroke();ctx.fillStyle='#cfe8ff';ctx.font='700 22px Inter, Arial';ctx.fillText(b.title,x+24,y+44);ctx.fillStyle='#eaf4ff';ctx.font='800 48px Inter, Arial';ctx.fillText(b.body,x+24,y+140)});const url=canvas.toDataURL('image/png');const a=document.createElement('a');a.href=url;a.download=`metrics-${Date.now()}.png`;a.click()}
function roundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath()}
$('refreshBtn').addEventListener('click',()=>{sample.pressure=Math.round(1000+Math.random()*50);sample.windSpeed=+(Math.random()*25).toFixed(1);sample.windDir=Math.floor(Math.random()*360);sample.gust=Math.round(5+Math.random()*20);sample.uv=Math.round(Math.random()*11);sample.visibility=+(Math.random()*12).toFixed(1);sample.precipChance=Math.round(Math.random()*100);sample.precipAmount=+(Math.random()*10).toFixed(1);sample.humidity=Math.round(30+Math.random()*70);sample.trend=(sample.trend||[]).slice(-7);sample.trend.push(sample.pressure);renderAll()});
$('exportBtn').addEventListener('click',exportGridPNG);$('topExportBtn').addEventListener('click',exportGridPNG);renderAll();
</script>
</body>
</html>
</template>

<script>
function sizeFrame(frame){
  try{
    var doc = frame.contentDocument || frame.contentWindow.document;
    var h1 = doc.documentElement ? doc.documentElement.scrollHeight : 0;
    var h2 = doc.body ? doc.body.scrollHeight : 0;
    var h = Math.max(h1,h2);
    var min = parseInt(frame.getAttribute('data-fallback'),10) || 500;
    frame.style.height = String(Math.max(h,min)) + 'px';
  }catch(e){
    var minFallback = parseInt(frame.getAttribute('data-fallback'),10) || 500;
    frame.style.height = String(minFallback) + 'px';
  }
}
document.querySelectorAll('.frame').forEach(function(f){
  var tplId = f.getAttribute('data-template');
  var tpl = document.getElementById(tplId);
  if(tpl){ f.srcdoc = tpl.innerHTML; }
  f.addEventListener('load', function(){ sizeFrame(f) });
});
window.addEventListener('resize', function(){
  document.querySelectorAll('.frame').forEach(function(f){ sizeFrame(f) });
});
</script>
</body>
</html>